<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MES æˆ°æƒ…å®¤</title>
    <style>
        /* ç°¡å–®çš„ CSS æ¨£å¼ */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f0f2f5; padding: 20px; }
        h1 { text-align: center; color: #333; }
        
        /* æ ¼ç‹€ä½ˆå±€ (Grid System) */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        /* æ©Ÿå°å¡ç‰‡æ¨£å¼ */
        .machine-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.2s;
        }
        .machine-card:hover { transform: translateY(-5px); }
        
        .machine-name { font-size: 1.5rem; font-weight: bold; margin-bottom: 10px; }
        .machine-location { color: #666; margin-bottom: 15px; }

        /* ç‹€æ…‹ç‡ˆè™Ÿæ¨£å¼ */
        .status-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            color: white;
            font-weight: bold;
        }

        /* æ ¹æ“šç‹€æ…‹è®Šè‰² (å°æ‡‰ Enum) */
        .status-idle { background-color: #f6ad55; }    /* é»ƒè‰² */
        .status-running { background-color: #48bb78; } /* ç¶ è‰² */
        .status-down { background-color: #f56565; }    /* ç´…è‰² */
        .status-repair { background-color: #4299e1; }  /* è—è‰² */

    </style>
</head>
<body>

    <h1>ğŸ­ MES å³æ™‚ç›£æ§çœ‹æ¿</h1>
    <div id="app" class="dashboard-grid">
        <p>è¼‰å…¥ä¸­...</p>
    </div>

    <script>
        // ==========================================
        // é‡è¦ï¼šè«‹å°‡æ­¤è™•çš„ PORT ä¿®æ”¹ç‚ºæ‚¨ Swagger ç¶²å€ä¸Šçš„ PORT
        // ä¾‹å¦‚ Swagger æ˜¯ http://localhost:5289/swagger... å‰‡å¡«å…¥ 5289
        // ==========================================
        const API_URL = 'http://localhost:5289/api/Equipment';

        // ç‹€æ…‹å°æ‡‰è¡¨ (å‰ç«¯å°æ‡‰å¾Œç«¯ Enum)
        // 0: Idle, 1: Running, 2: Down, 3: Repair
        const statusMap = {
            0: { text: 'é–’ç½® (Idle)', class: 'status-idle' },
            1: { text: 'é‹ä½œä¸­ (Running)', class: 'status-running' },
            2: { text: 'æ•…éšœ (Down)', class: 'status-down' },
            3: { text: 'ç¶­ä¿®ä¸­ (Repair)', class: 'status-repair' }
        };

        // è®€å–è³‡æ–™å‡½å¼
        async function fetchData() {
            try {
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error('ç¶²è·¯å›æ‡‰ä¸æ­£å¸¸');
                }

                const data = await response.json();
                renderDashboard(data);

            } catch (error) {
                console.error('API éŒ¯èª¤:', error);
                document.getElementById('app').innerHTML = `<p style="color:red">ç„¡æ³•é€£ç·šåˆ° APIã€‚è«‹ç¢ºèªå¾Œç«¯æ˜¯å¦å·²å•Ÿå‹•ï¼Œä»¥åŠ Port æ˜¯å¦æ­£ç¢ºã€‚<br>éŒ¯èª¤è¨Šæ¯: ${error.message}</p>`;
            }
        }

        // æ¸²æŸ“ç•«é¢å‡½å¼
        function renderDashboard(equipments) {
            const container = document.getElementById('app');
            container.innerHTML = ''; // æ¸…ç©ºè¼‰å…¥æ–‡å­—

            equipments.forEach(eq => {
                // å–å¾—å°æ‡‰çš„ç‹€æ…‹æ–‡å­—èˆ‡é¡è‰² Class
                const statusInfo = statusMap[eq.status] || { text: 'æœªçŸ¥', class: 'status-idle' };

                // ç”Ÿæˆ HTML
                const cardHtml = `
                    <div class="machine-card">
                        <div class="machine-name">${eq.name}</div>
                        <div class="machine-location">ğŸ“ ${eq.location}</div>
                        <div class="status-indicator ${statusInfo.class}">
                            ${statusInfo.text}
                        </div>
                        <div style="margin-top:10px; font-size:0.8rem; color:#999;">
                            æœ€å¾Œæ›´æ–°: ${new Date(eq.lastUpdated).toLocaleTimeString()}
                        </div>
                    </div>
                `;
                container.innerHTML += cardHtml;
            });
        }

        // å•Ÿå‹•ï¼
        fetchData();
        
        // æ¯ 5 ç§’è‡ªå‹•é‡æ–°æ•´ç†ä¸€æ¬¡ (æ¨¡æ“¬å³æ™‚ç›£æ§)
        setInterval(fetchData, 5000);

    </script>
</body>
</html>